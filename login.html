<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Log-in</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-firestore.js"></script>
	<script>

		// Initialize Firebase
		var config = {
			apiKey: "AIzaSyDg8cKLvS8KuVCxeahzMNQJvt5FG7r4Ay8",
			authDomain: "pixelmeme-4e7cf.firebaseapp.com",
			databaseURL: "https://pixelmeme-4e7cf.firebaseio.com",
			projectId: "pixelmeme-4e7cf",
			storageBucket: "",
			messagingSenderId: "548501828671"
		};
		firebase.initializeApp(config);
	</script>
</head>
<body>
<div id="regSign">
	<input type="text" id="email" name="email" placeholder="Email...">
	<input type="password" id="password" name="password" placeholder="Password...">
	<button id="signup">SignUp</button>
	<button id="signin">SignIn</button>
</div>

<script>
	$('#signin').click(function(){
		var email = $('#username').value;
		var password = $('#password').value;
		if (email.length < 4) {
			alert('Please enter an email address.');
			return;
		}
		if (password.length < 4) {
			alert('Please enter a password.');
			return;
		}
		firebase.auth().signInWithEmailAndPassword(email, password).catch(function (error) {
			// Handle Errors here.
			var errorCode = error.code;
			var errorMessage = error.message;
			console.log(errorCode, errorMessage);
			// ...
		});
	});
	$('#signup').click(function(){
		var email = $('#username').value;
		var password = $('#password').value;
		alert(email);
		if (email.length < 4) {
			alert('Please enter an email address.');
			return;
		}
		if (password.length < 4) {
			alert('Please enter a password.');
			return;
		}
		firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
			var errorCode = error.code;
			var errorMessage = error.message;
			if (errorCode == 'auth/weak-password') {
				alert('The password is too weak.');
			} else {
				alert(errorMessage);
			}
			console.log(error);
		});
	});
	firebase.auth().onAuthStateChanged(function (user) {
		if (user) {
			console.log("user signed in!")
			if(firebase.firestore().collection('users').doc(user.uid).get() === null){
				alert("User in database not found!");
				firebase.firestore().collection('users').doc(user.uid).set(user);
				window.location.replace("/index.html");
			}
		}
	});
</script>
</body>
</html>